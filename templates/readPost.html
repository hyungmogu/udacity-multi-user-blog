{%extends "base.html"%}

{%block title%}{{blog.title}} | Multi User Blog Site{%endblock%}

{%block import%}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
{%endblock%}

{%block navigation%}
	<nav>
	{%if signed_in%}
		<a href="/blog/logout">Logout</a>
	{%else%}
		<a href="/blog/login">Login / Sign-up</a>
	{%endif%}
	</nav>
{%endblock%}

{%block content_header%}
	<section id="content-header" class="header">
		<h2 class="title">{{blog.title}}</h2>
		<div class="date">
			{{blog.dateCreated.strftime('%B %d, %Y %I:%M%p')}}
		</div>
		<div class="meta">
			<span id="number-of-likes">{{blog.numberOfLikes}}</span>
			<!-- Need to add blog.author.username here -->
		</div>
		<div class="options">
			<a href="/blog/{{blog.key().id()}}/edit">Edit</a>
			<a href="/blog/{{blog.key().id()}}/delete">Delete</a>
		</div>
	</section>
{%endblock%}

{%block content%}
	<article class="blog">
		<p>{{blog.content}}</p>
	</article>
{%endblock%}

{%block content_footer%}
	<section id="content-footer">
		<div class="likes">
			<button id="like" data-liked="false">Like This Page</button>
		</div>
	</section>
{%endblock%}

{%block javascript%}
<script>
	$(document).ready(function(){

		$('#like').click(function(){
			$liked = ($('#like').attr('data-liked') == 'true');
			if($liked){
				$.ajax({
					type: 'POST',
					url: '/blog/{{blog.key().id()}}/like',
					dataType: "json",
					success: function(result){
						if(result["error"]){
							console.log(result["error"]);
						} else {
							$('#number-of-likes').html(result["new_count"]);
							$('#like').attr('data-liked','false');
							$('#like').html('Like This Page');
						}
					},
					error: function(error){
						console.log(error);
					}
				});
			} else {
				$.ajax({
					type: 'POST',
					url: '/blog/{{blog.key().id()}}/like',
					dataType: "json",
					success: function(result){
						if(result["error"]){
							console.log(result["error"]);
						} else {
							$('#number-of-likes').html(result["new_count"]);
							$('#like').attr('data-liked','true');
							$('#like').html('Liked');
						}
					},
					error: function(error){
						console.log(error);
					}
				});				
			}
		});
	});

</script>
{%endblock%}

